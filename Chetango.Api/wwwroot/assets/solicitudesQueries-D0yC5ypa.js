import{c as G,j as e,u as j,h as g,F as A,J as L,r as h,G as B,X as re,C as xe,K as Z,M as ee,N as ae,O as se,P as U,U as be,L as he,m as te,ag as ge}from"./index-xg0wAXn9.js";import{u as D}from"./useMutation-C0w7SSmQ.js";import{G as ye}from"./GlassPanel-DsiEcOyo.js";import{u as ce,C as ne,T as ve,F as je}from"./useModalScroll-bImGwwMj.js";const Ne=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Pe=G("image",Ne);const qe=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],de=G("plus",qe);const Ce=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],oe=G("search",Ce);const we=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],Ge=G("star",we);const ke=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],Fe=G("upload",ke);function O({label:a,icon:s,error:n,className:l="",...m}){return e.jsxs("div",{className:l,children:[a&&e.jsx("label",{className:"block text-[#d1d5db] mb-2 text-sm",children:a}),e.jsxs("div",{className:"relative",children:[s&&e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-[#6b7280] z-10",children:s}),e.jsx("input",{className:`
            w-full 
            ${s?"pl-12":"pl-4"} 
            pr-4 py-3 
            backdrop-blur-xl 
            bg-[rgba(30,30,36,0.6)] 
            border 
            ${n?"border-[#ef4444]":"border-[rgba(255,255,255,0.12)]"}
            focus:border-[#c93448] 
            focus:ring-2 
            focus:ring-[rgba(201,52,72,0.3)] 
            rounded-xl 
            text-[#f9fafb] 
            placeholder-[#6b7280] 
            outline-none 
            transition-all duration-300 
            shadow-[inset_0_2px_4px_rgba(0,0,0,0.3),0_1px_2px_rgba(255,255,255,0.05)] 
            focus:shadow-[inset_0_2px_4px_rgba(0,0,0,0.3),0_0_0_3px_rgba(201,52,72,0.2)]
          `,...m})]}),n&&e.jsx("p",{className:"text-[#fca5a5] text-sm mt-1",children:n})]})}const q={all:["classes"],tiposClase:()=>[...q.all,"tipos-clase"],profesores:()=>[...q.all,"profesores"],clasesByProfesor:(a,s)=>[...q.all,"by-profesor",a,s],claseDetail:a=>[...q.all,"detail",a]};function He(){return j({queryKey:q.tiposClase(),queryFn:async()=>(await g.get("/api/tipos-clase")).data,staleTime:300*1e3})}function Ue(a=!0){return j({queryKey:q.profesores(),queryFn:async()=>(await g.get("/api/profesores")).data.map(n=>({idProfesor:n.idProfesor,nombreCompleto:n.nombre,tipoProfesor:"Titular"})),enabled:a,staleTime:300*1e3})}function Oe(a,s,n=!0){return j({queryKey:q.clasesByProfesor(a,s),queryFn:async()=>{const l=new URLSearchParams;s.fechaDesde&&l.append("fechaDesde",s.fechaDesde),s.fechaHasta&&l.append("fechaHasta",s.fechaHasta),s.pagina&&l.append("pageNumber",s.pagina.toString()),s.tamanoPagina&&l.append("pageSize",s.tamanoPagina.toString());const m=l.toString(),y=`/api/profesores/${a}/clases${m?`?${m}`:""}`;return(await g.get(y)).data},enabled:n&&!!a})}function We(a,s=!0){return j({queryKey:q.claseDetail(a),queryFn:async()=>(await g.get(`/api/clases/${a}`)).data,enabled:s&&!!a})}function Te(a,s){if(!a)return s;const n=a;if(n?.status&&n?.message)return n.message;const l=a,m=l?.response?.status,y=l?.response?.data?.error||l?.response?.data?.message;return m===400&&y?y:m===404?"La clase especificada no existe":m===403?"No tienes permisos para realizar esta acciÃ³n":y||s}function Je(){const a=A();return D({mutationFn:async s=>(await g.post("/api/clases",s)).data,onSuccess:()=>{L.success("Clase creada exitosamente"),a.invalidateQueries({queryKey:q.all})},onError:()=>{}})}function Xe(){const a=A();return D({mutationFn:async({idClase:s,data:n})=>{await g.put(`/api/clases/${s}`,n)},onSuccess:(s,n)=>{L.success("Clase actualizada exitosamente"),a.invalidateQueries({queryKey:q.claseDetail(n.idClase)}),a.invalidateQueries({queryKey:q.all})},onError:()=>{}})}function Ye(){const a=A();return D({mutationFn:async s=>{await g.delete(`/api/clases/${s}`)},onSuccess:()=>{L.success("Clase cancelada exitosamente"),a.invalidateQueries({queryKey:q.all})},onError:()=>{}})}function Ze(){const a=A();return D({mutationFn:async s=>{const{data:n}=await g.post(`/api/clases/${s}/completar`);return n},onSuccess:()=>{L.success("Clase completada y pagos generados exitosamente"),a.invalidateQueries({queryKey:q.all}),a.invalidateQueries({queryKey:["payroll"]})},onError:s=>{const n=Te(s,"Error al completar la clase");L.error(n)}})}function ea(a,s){const[n,l]=a.split(":").map(Number),[m,y]=s.split(":").map(Number);return m*60+y-(n*60+l)}function aa(a){return a.find(s=>s.rolEnClase==="Principal")}function Me(a,s){return a.filter(n=>n.rolEnClase===s).length}function Se(a){return new Set(a.map(n=>n.idProfesor)).size!==a.length}function sa(a){return`${a}:00`}function ra(a,s){return`${a}T${s}:00`}function _e(a){return a?a.split("T")[0]:""}function le(a){return a?a.substring(0,5):""}function Ee(a){return!a||a.length===0?{valido:!1,mensaje:"Debe agregar al menos un profesor"}:Me(a,"Principal")===0?{valido:!1,mensaje:"Debe haber al menos un profesor con rol Principal"}:Se(a)?{valido:!1,mensaje:"No puede agregar el mismo profesor dos veces"}:{valido:!0}}function Ie(a,s){if(!a||!s)return!1;const n=new Date;return new Date(`${a}T${s}`)>n}function Ke(a,s){if(!a||!s)return!1;const[n,l]=a.split(":").map(Number),[m,y]=s.split(":").map(Number),N=n*60+l;return m*60+y>N}function Qe(){return te()}const ie=(a,s)=>{if(a){let l=[];return a.profesores&&a.profesores.length>0?l=a.profesores.map(m=>({idProfesor:m.idProfesor,rolEnClase:m.rolEnClase})):(a.idProfesorPrincipal&&l.push({idProfesor:a.idProfesorPrincipal,rolEnClase:"Principal"}),a.monitores&&a.monitores.length>0&&a.monitores.forEach(m=>{l.push({idProfesor:m.idProfesor,rolEnClase:"Monitor"})})),{fecha:_e(a.fecha),horaInicio:le(a.horaInicio),horaFin:le(a.horaFin),idTipoClase:"",profesores:l,cupoMaximo:a.cupoMaximo,observaciones:a.observaciones||""}}return{...{fecha:"",horaInicio:"",horaFin:"",idTipoClase:"",profesores:[],cupoMaximo:10,observaciones:""},...s||{}}};function ta({isOpen:a,onClose:s,onSubmit:n,tiposClase:l,profesores:m,isCatalogsLoading:y=!1,isSubmitting:N=!1,mode:C="create",initialData:w=null,prefillData:_}){const J=ce(a),[i,S]=h.useState(()=>ie(w,_)),[v,E]=h.useState({}),[k,T]=h.useState({});h.useEffect(()=>{if(a){const t=ie(w,_);if(w&&l.length>0){const u=l.find(f=>f.nombre===w.tipoClase);u&&(t.idTipoClase=u.id)}S(t),E({}),T({})}},[a,w,_,l]);const I=h.useCallback(()=>{const t={};i.fecha||(t.fecha="La fecha es requerida"),i.horaInicio||(t.horaInicio="La hora de inicio es requerida"),i.horaFin||(t.horaFin="La hora de fin es requerida"),i.idTipoClase||(t.idTipoClase="El tipo de clase es requerido");const u=Ee(i.profesores);return u.valido||(t.idProfesorPrincipal=u.mensaje),(!i.cupoMaximo||i.cupoMaximo<1)&&(t.cupoMaximo="El cupo debe ser al menos 1"),C==="create"&&i.fecha&&i.horaInicio&&!Ie(i.fecha,i.horaInicio)&&(t.fecha="La clase debe programarse para una fecha y hora futura"),i.horaInicio&&i.horaFin&&!Ke(i.horaInicio,i.horaFin)&&(t.horaFin="La hora de fin debe ser posterior a la hora de inicio"),t},[i,C]),M=h.useCallback((t,u)=>{S(f=>({...f,[t]:u})),T(f=>({...f,[t]:!0}))},[]),X=h.useCallback(()=>{S(t=>({...t,profesores:[...t.profesores,{idProfesor:"",rolEnClase:"Monitor"}]}))},[]),K=h.useCallback(t=>{S(u=>({...u,profesores:u.profesores.filter((f,F)=>F!==t)}))},[]),Q=h.useCallback((t,u,f)=>{S(F=>({...F,profesores:F.profesores.map(($,P)=>P===t?{...$,[u]:f}:$)})),T(F=>({...F,profesores:!0}))},[]),d=h.useCallback(t=>{T(u=>({...u,[t]:!0}))},[]);h.useEffect(()=>{const t=I();E(t)},[I]);const z=async t=>{t.preventDefault(),T({fecha:!0,horaInicio:!0,horaFin:!0,idTipoClase:!0,idProfesorPrincipal:!0,cupoMaximo:!0});const u=I();if(E(u),!(Object.keys(u).length>0))try{await n(i),s()}catch{E(f=>({...f,general:"Error al guardar la clase. Intenta de nuevo."}))}};if(!a)return null;const V=Object.keys(I()).length===0,H=C==="create"?"Nueva Clase":"Editar Clase",R=C==="create"?"Crear Clase":"Guardar Cambios";return e.jsxs("div",{ref:J,className:"fixed inset-0 z-[100] pt-20 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md -z-10",onClick:s}),e.jsx("div",{className:"relative flex items-start justify-center p-4 min-h-full",children:e.jsxs(ye,{className:"relative w-full max-w-lg flex flex-col my-8 overflow-hidden",children:[e.jsx("div",{className:"p-6 pb-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white",children:H}),e.jsx(B,{variant:"icon",onClick:s,disabled:N,className:"!p-2",children:e.jsx(re,{className:"w-5 h-5"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 pb-6",children:e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[v.general&&e.jsx("div",{className:"p-3 rounded-lg bg-red-500/20 border border-red-500/40 text-red-300 text-sm",children:v.general}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 mb-2 text-sm",children:["Fecha ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx(O,{type:"date",value:i.fecha,onChange:t=>M("fecha",t.target.value),onBlur:()=>d("fecha"),min:C==="create"?Qe():void 0,icon:e.jsx(xe,{className:"w-4 h-4"}),error:k.fecha?v.fecha:void 0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 mb-2 text-sm",children:["Hora Inicio ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx(O,{type:"time",value:i.horaInicio,onChange:t=>M("horaInicio",t.target.value),onBlur:()=>d("horaInicio"),icon:e.jsx(ne,{className:"w-4 h-4"}),error:k.horaInicio?v.horaInicio:void 0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 mb-2 text-sm",children:["Hora Fin ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx(O,{type:"time",value:i.horaFin,onChange:t=>M("horaFin",t.target.value),onBlur:()=>d("horaFin"),icon:e.jsx(ne,{className:"w-4 h-4"}),error:k.horaFin?v.horaFin:void 0})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 mb-2 text-sm",children:["Tipo de Clase ",e.jsx("span",{className:"text-red-400",children:"*"})]}),y?e.jsx("div",{className:"h-12 bg-white/5 rounded-xl animate-pulse"}):e.jsxs(Z,{value:i.idTipoClase,onValueChange:t=>M("idTipoClase",t),children:[e.jsx(ee,{className:k.idTipoClase&&v.idTipoClase?"border-red-500":"",children:e.jsx(ae,{placeholder:"Seleccionar tipo de clase"})}),e.jsx(se,{children:l.map(t=>e.jsx(U,{value:t.id,children:t.nombre},t.id))})]}),k.idTipoClase&&v.idTipoClase&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:v.idTipoClase})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("label",{className:"block text-gray-300 text-sm",children:["Profesores ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsxs(B,{type:"button",variant:"secondary",onClick:X,disabled:y,className:"!py-1 !px-3 !text-sm flex items-center gap-1",children:[e.jsx(de,{className:"w-4 h-4"}),"Agregar Profesor"]})]}),y?e.jsx("div",{className:"h-12 bg-white/5 rounded-xl animate-pulse"}):e.jsx("div",{className:"space-y-3",children:i.profesores.length===0?e.jsx("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10 text-center text-gray-400 text-sm",children:'No hay profesores agregados. Haz clic en "Agregar Profesor" para comenzar.'}):i.profesores.map((t,u)=>e.jsxs("div",{className:"flex gap-2 items-start p-3 rounded-xl bg-white/5 border border-white/10",children:[e.jsx("div",{className:"flex-1",children:e.jsxs(Z,{value:t.idProfesor,onValueChange:f=>Q(u,"idProfesor",f),children:[e.jsx(ee,{className:"w-full",children:e.jsx(ae,{placeholder:"Seleccionar profesor"})}),e.jsx(se,{children:m.map(f=>e.jsx(U,{value:f.idProfesor,disabled:i.profesores.some((F,$)=>$!==u&&F.idProfesor===f.idProfesor),children:f.nombreCompleto},f.idProfesor))})]})}),e.jsx("div",{className:"w-32",children:e.jsxs(Z,{value:t.rolEnClase,onValueChange:f=>Q(u,"rolEnClase",f),children:[e.jsx(ee,{className:"w-full",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(U,{value:"Principal",children:"Principal"}),e.jsx(U,{value:"Monitor",children:"Monitor"})]})]})}),e.jsx(B,{type:"button",variant:"icon",onClick:()=>K(u),className:"!p-2 text-red-400 hover:text-red-300",children:e.jsx(ve,{className:"w-4 h-4"})})]},u))}),k.profesores&&v.idProfesorPrincipal&&e.jsx("p",{className:"text-red-400 text-sm mt-1",children:v.idProfesorPrincipal}),e.jsx("p",{className:"text-gray-400 text-xs mt-2",children:'Debe haber al menos un profesor con rol "Principal". Puedes agregar varios profesores principales y monitores.'})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-300 mb-2 text-sm",children:["Cupo MÃ¡ximo ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx(O,{type:"number",min:1,max:100,value:i.cupoMaximo.toString(),onChange:t=>M("cupoMaximo",parseInt(t.target.value,10)||1),onBlur:()=>d("cupoMaximo"),icon:e.jsx(be,{className:"w-4 h-4"}),error:k.cupoMaximo?v.cupoMaximo:void 0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-300 mb-2 text-sm",children:"Observaciones"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-4 top-3 text-gray-500",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx("textarea",{value:i.observaciones,onChange:t=>M("observaciones",t.target.value),placeholder:"Notas adicionales sobre la clase...",rows:3,className:`\r
                  w-full pl-12 pr-4 py-3\r
                  backdrop-blur-xl\r
                  bg-[rgba(30,30,36,0.6)]\r
                  border border-[rgba(255,255,255,0.12)]\r
                  focus:border-[#c93448]\r
                  focus:ring-2 focus:ring-[rgba(201,52,72,0.3)]\r
                  rounded-xl\r
                  text-[#f9fafb]\r
                  placeholder-[#6b7280]\r
                  outline-none\r
                  transition-all duration-300\r
                  shadow-[inset_0_2px_4px_rgba(0,0,0,0.3),0_1px_2px_rgba(255,255,255,0.05)]\r
                  focus:shadow-[inset_0_2px_4px_rgba(0,0,0,0.3),0_0_0_3px_rgba(201,52,72,0.2)]\r
                  resize-none\r
                `})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4",children:[e.jsx(B,{type:"button",variant:"secondary",onClick:s,disabled:N,children:"Cancelar"}),e.jsx(B,{type:"submit",variant:"primary",disabled:N||!V,children:N?e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{children:"Guardando..."})]}):R})]})]})})]})})]})}const ze=a=>j({queryKey:["students","search",a],queryFn:async()=>{const s=a.trim()?`?filtro=${encodeURIComponent(a)}`:"";return(await g.get(`/api/alumnos${s}`)).data},enabled:a.trim().length>=2,staleTime:3e4}),x={all:["payments"],lists:()=>[...x.all,"list"],list:a=>[...x.lists(),a],details:()=>[...x.all,"detail"],detail:a=>[...x.details(),a],stats:()=>[...x.all,"stats"],methods:()=>[...x.all,"methods"],pending:()=>[...x.all,"pending"],verified:()=>[...x.all,"verified"],allVerified:()=>[...x.all,"all-verified"]},na=()=>j({queryKey:x.pending(),queryFn:async()=>{const{data:a}=await g.get("/api/pagos/pendientes");return a},refetchInterval:3e4}),oa=()=>j({queryKey:x.verified(),queryFn:async()=>{const{data:a}=await g.get("/api/pagos/verificados-hoy");return a},refetchInterval:3e4}),la=()=>j({queryKey:x.allVerified(),queryFn:async()=>{const{data:a}=await g.get("/api/pagos/verificados");return a},refetchInterval:3e4}),ia=a=>j({queryKey:x.detail(a),queryFn:async()=>{const{data:s}=await g.get(`/api/pagos/${a}`);return s},enabled:!!a}),ca=()=>j({queryKey:x.stats(),queryFn:async()=>{const{data:a}=await g.get("/api/pagos/estadisticas");return a}}),$e=()=>j({queryKey:x.methods(),queryFn:async()=>{const{data:a}=await g.get("/api/pagos/metodos-pago");return a}}),Ae=()=>j({queryKey:["packageTypes"],queryFn:async()=>{const{data:a}=await g.get("/api/tipos-paquete");return a}}),De=()=>{const a=A();return D({mutationFn:async s=>{const{data:n}=await g.post("/api/pagos",s);return n},onSuccess:()=>{a.invalidateQueries({queryKey:x.lists()}),a.invalidateQueries({queryKey:x.stats()}),a.invalidateQueries({queryKey:x.verified()})}})},da=()=>{const a=A();return D({mutationFn:async s=>{const{data:n}=await g.post(`/api/pagos/${s.idPago}/verificar`,s);return n},onSuccess:()=>{a.invalidateQueries({queryKey:x.pending()}),a.invalidateQueries({queryKey:x.verified()}),a.invalidateQueries({queryKey:x.allVerified()}),a.invalidateQueries({queryKey:x.lists()}),a.invalidateQueries({queryKey:x.stats()})}})},ua=({isOpen:a,onClose:s,onSuccess:n,initialAlumno:l=null,initialNota:m})=>{const y=ce(a),[N,C]=h.useState(""),[w,_]=h.useState(null),[J,i]=h.useState(!1),[S,v]=h.useState(null),[E,k]=h.useState(!1),[T,I]=h.useState(null),[M,X]=h.useState([]),[K,Q]=h.useState({}),[d,z]=h.useState({montoTotal:0,fechaPago:te(),paquetes:[]}),V=d.paquetes?.length??0,{data:H}=$e(),{data:R}=Ae(),{data:t,isLoading:u}=ze(N),f=De();if(h.useEffect(()=>{a&&(l&&(_(l),C(l.nombre),V>0&&Q(r=>{const o={...r};for(let p=0;p<V;p+=1)o[p]||(o[p]=l);return o})),m&&z(r=>({...r,nota:m})))},[a,l,m,V]),!a)return null;const F=async r=>{const o=r.target.files?.[0];if(!o)return;const p=new FileReader;p.onloadend=()=>{I(p.result)},p.readAsDataURL(o),k(!0);try{const c=new FormData;c.append("comprobante",o);const b=await g.post("/api/pagos/upload-comprobante",c,{headers:{"Content-Type":"multipart/form-data"}});P("comprobanteUrl",b.data.url)}catch(c){console.error("Error subiendo comprobante:",c),alert("Error al subir el comprobante"),I(null)}finally{k(!1)}},$=async r=>{r.preventDefault();const o=d.paquetes?.filter((p,c)=>!K[c]);if(o&&o.length>0){alert("Todos los paquetes deben tener un alumno asignado");return}try{const p=d.paquetes?.map((c,b)=>({...c,idAlumno:K[b].idAlumno}));await f.mutateAsync({...d,idAlumno:null,paquetes:p,idsPaquetesExistentes:M.length>0?M:void 0}),n?.(),s(),C(""),_(null),X([]),Q({}),z({montoTotal:0,fechaPago:te(),paquetes:[]})}catch(p){console.error("Error registrando pago:",p)}},P=(r,o)=>{z(p=>({...p,[r]:o}))},ue=r=>{S!==null?(Q(o=>({...o,[S]:r})),v(null)):_(r),C(r.nombre),i(!1)},pe=()=>{const r=d.paquetes?.length||0;z(o=>({...o,paquetes:[...o.paquetes||[],{idAlumno:w?.idAlumno||"",idTipoPaquete:"",clasesDisponibles:0,valorPaquete:0,diasVigencia:30}]})),w&&Q(o=>({...o,[r]:w}))},me=r=>r?r.toLowerCase().includes("2 personas")||r.toLowerCase().includes("2p"):!1,fe=(r,o)=>{const p=[...d.paquetes||[]],c=K[r]||w;p[r]={idAlumno:c?.idAlumno||"",idTipoPaquete:o.idTipoPaquete,clasesDisponibles:o.numeroClases,valorPaquete:o.precio,diasVigencia:o.diasVigencia},P("paquetes",p),me(o.nombre)&&p.length===1&&setTimeout(()=>{z(b=>({...b,paquetes:[...p,{idAlumno:c?.idAlumno||"",idTipoPaquete:o.idTipoPaquete,clasesDisponibles:o.numeroClases,valorPaquete:0,diasVigencia:o.diasVigencia}]}))},100)};return e.jsxs("div",{ref:y,className:"fixed inset-0 z-[100] flex items-start justify-center pt-20 px-4 pb-8 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-md -z-10",onClick:s}),e.jsxs("div",{className:"relative z-10 bg-[rgba(26,26,26,0.98)] border border-[rgba(64,64,64,0.3)] rounded-2xl w-full max-w-3xl overflow-hidden",children:[e.jsxs("div",{className:"bg-[rgba(26,26,26,0.98)] border-b border-[rgba(64,64,64,0.3)] p-6 flex items-center justify-between",children:[e.jsx("h2",{className:"text-[#f9fafb] text-2xl font-semibold",children:"ðŸ’° Registrar Pago"}),e.jsx("button",{onClick:s,className:"text-[#9ca3af] hover:text-[#f9fafb] transition-colors",children:e.jsx(re,{size:24})})]}),e.jsxs("form",{onSubmit:$,className:"p-6 space-y-6",children:[J&&N.trim().length>=0&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:()=>i(!1),children:[e.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"}),e.jsxs("div",{className:"relative z-10 bg-[rgba(26,26,26,0.98)] border border-[rgba(64,64,64,0.3)] rounded-lg shadow-2xl w-full max-w-2xl max-h-96 overflow-hidden",onClick:r=>r.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b border-[rgba(64,64,64,0.3)]",children:e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-[#6b7280]",size:20}),e.jsx("input",{type:"text",placeholder:"Buscar alumno por nombre o documento...",value:N,onChange:r=>C(r.target.value),autoFocus:!0,className:"w-full pl-12 pr-4 py-3 rounded-lg bg-[rgba(255,255,255,0.05)] border border-[rgba(255,255,255,0.1)] text-[#f9fafb] focus:outline-none focus:border-[#c93448] transition-colors"})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-80",children:[u&&e.jsx("div",{className:"p-4 text-center text-[#9ca3af]",children:"Buscando..."}),t&&t.length===0&&N.trim().length>=2&&e.jsx("div",{className:"p-4 text-center text-[#9ca3af]",children:"No se encontraron alumnos"}),!N&&e.jsx("div",{className:"p-4 text-center text-[#6b7280]",children:"Escribe para buscar alumnos..."}),t&&t.map(r=>e.jsxs("button",{type:"button",onClick:()=>ue(r),className:"w-full p-4 text-left hover:bg-[rgba(201,52,72,0.1)] transition-colors border-b border-[rgba(64,64,64,0.3)] last:border-0",children:[e.jsx("div",{className:"text-[#f9fafb] font-medium",children:r.nombre}),e.jsxs("div",{className:"text-sm text-[#9ca3af] flex gap-3 mt-1",children:[r.numeroDocumento&&e.jsxs("span",{children:["CC: ",r.numeroDocumento]}),r.telefono&&e.jsxs("span",{children:["ðŸ“± ",r.telefono]})]})]},r.idAlumno))]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#f9fafb] text-sm font-medium mb-2",children:"Monto Total *"}),e.jsx("input",{type:"number",required:!0,min:"0",step:"1000",value:d.montoTotal,onChange:r=>P("montoTotal",parseFloat(r.target.value)),className:"w-full px-4 py-3 rounded-lg bg-[rgba(255,255,255,0.05)] border border-[rgba(255,255,255,0.1)] text-[#f9fafb] focus:outline-none focus:border-[#c93448] transition-colors",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#f9fafb] text-sm font-medium mb-2",children:"Fecha de Pago *"}),e.jsx("input",{type:"date",required:!0,value:d.fechaPago,onChange:r=>P("fechaPago",r.target.value),className:"w-full px-4 py-3 rounded-lg bg-[rgba(255,255,255,0.05)] border border-[rgba(255,255,255,0.1)] text-[#f9fafb] focus:outline-none focus:border-[#c93448] transition-colors"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#f9fafb] text-sm font-medium mb-2",children:"MÃ©todo de Pago *"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:H?.map(r=>e.jsx("button",{type:"button",onClick:()=>P("idMetodoPago",r.idMetodoPago),className:`py-3 px-4 rounded-lg border transition-all ${d.idMetodoPago===r.idMetodoPago?"bg-[rgba(201,52,72,0.15)] border-[rgba(201,52,72,0.3)] text-[#c93448]":"bg-[rgba(64,64,64,0.2)] border-[rgba(64,64,64,0.3)] text-[#9ca3af] hover:border-[rgba(201,52,72,0.2)]"}`,children:r.nombre},r.idMetodoPago))})]}),d.idMetodoPago&&H?.find(r=>r.idMetodoPago===d.idMetodoPago)?.nombre==="Transferencia Bancaria"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#f9fafb] text-sm font-medium mb-2",children:"Referencia"}),e.jsx("input",{type:"text",value:d.referencia||"",onChange:r=>P("referencia",r.target.value),className:"w-full px-4 py-3 rounded-lg bg-[rgba(255,255,255,0.05)] border border-[rgba(255,255,255,0.1)] text-[#f9fafb] focus:outline-none focus:border-[#c93448] transition-colors",placeholder:"NÃºmero de referencia de la transferencia"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#f9fafb] text-sm font-medium mb-2",children:"Comprobante de Pago"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex-1 flex items-center justify-center gap-3 px-4 py-8 rounded-lg bg-[rgba(255,255,255,0.05)] border-2 border-dashed border-[rgba(255,255,255,0.1)] hover:border-[#c93448] cursor-pointer transition-all",children:[e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:F,className:"hidden",disabled:E}),E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-[#c93448] border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-[#9ca3af]",children:"Subiendo..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"text-[#c93448]",size:24}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[#f9fafb] font-medium",children:"Click para subir comprobante"}),e.jsx("p",{className:"text-[#9ca3af] text-sm",children:"JPG, PNG, PDF (mÃ¡x. 10MB)"})]})]})]}),T&&e.jsx("div",{className:"w-32 h-32 rounded-lg border border-[rgba(255,255,255,0.1)] overflow-hidden bg-[rgba(255,255,255,0.05)] flex items-center justify-center",children:T.endsWith(".pdf")?e.jsx(Pe,{className:"text-[#9ca3af]",size:32}):e.jsx("img",{src:T,alt:"Preview",className:"w-full h-full object-cover"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#f9fafb] text-sm font-medium mb-2",children:"Nota (opcional)"}),e.jsx("textarea",{rows:3,value:d.nota||"",onChange:r=>P("nota",r.target.value),className:"w-full px-4 py-3 rounded-lg bg-[rgba(255,255,255,0.05)] border border-[rgba(255,255,255,0.1)] text-[#f9fafb] focus:outline-none focus:border-[#c93448] transition-colors resize-none",placeholder:"Observaciones adicionales..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"text-[#f9fafb] text-sm font-medium",children:"Paquetes Asociados"}),e.jsxs("button",{type:"button",onClick:pe,className:"flex items-center gap-2 px-3 py-1.5 bg-[rgba(201,52,72,0.15)] hover:bg-[rgba(201,52,72,0.25)] text-[#c93448] rounded-lg text-sm transition-all",children:[e.jsx(de,{size:16}),"Agregar Paquete"]})]}),e.jsxs("div",{className:"space-y-3",children:[d.paquetes?.map((r,o)=>{const p=R?.find(c=>c.idTipoPaquete===r.idTipoPaquete);return e.jsxs("div",{className:"p-4 rounded-lg bg-[rgba(255,255,255,0.05)] border border-[rgba(255,255,255,0.1)] space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-[#f9fafb] text-sm font-medium",children:["Paquete ",o+1]}),e.jsx("button",{type:"button",onClick:()=>{const c=d.paquetes?.filter((b,Y)=>Y!==o);P("paquetes",c)},className:"text-[#ef4444] hover:text-[#dc2626] transition-colors",children:e.jsx(re,{size:16})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-[#9ca3af] text-xs mb-1",children:"Alumno para este paquete *"}),e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-[#6b7280]",size:16}),e.jsx("input",{type:"text",placeholder:"Click para buscar alumno...",value:K[o]?.nombre||"",onFocus:()=>{v(o),C(""),i(!0)},readOnly:!0,className:"w-full pl-10 pr-4 py-2 rounded-lg bg-[rgba(255,255,255,0.05)] border border-[rgba(255,255,255,0.1)] text-[#f9fafb] text-sm focus:outline-none focus:border-[#c93448] transition-colors cursor-pointer"}),K[o]&&e.jsx(ge,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-green-500",size:16})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-[#9ca3af] text-xs mb-1",children:"Tipo de Paquete *"}),e.jsxs("select",{value:r.idTipoPaquete,onChange:c=>{const b=R?.find(Y=>Y.idTipoPaquete===c.target.value);b&&fe(o,b)},className:"w-full px-3 py-2 rounded-lg bg-[rgba(255,255,255,0.05)] border border-[rgba(255,255,255,0.1)] text-[#f9fafb] text-sm focus:outline-none focus:border-[#c93448] transition-colors",children:[e.jsx("option",{value:"",children:"Seleccionar tipo..."}),R?.map(c=>e.jsxs("option",{value:c.idTipoPaquete,children:[c.nombre," - $",c.precio.toLocaleString()," (",c.numeroClases," clases, ",c.diasVigencia," dÃ­as)"]},c.idTipoPaquete))]})]}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#9ca3af] text-xs mb-1",children:"Clases"}),e.jsx("input",{type:"number",min:"1",value:r.clasesDisponibles,onChange:c=>{const b=[...d.paquetes||[]];b[o]={...b[o],clasesDisponibles:parseInt(c.target.value)||0},P("paquetes",b)},className:"w-full px-3 py-2 rounded-lg bg-[rgba(255,255,255,0.05)] border border-[rgba(255,255,255,0.1)] text-[#f9fafb] text-sm focus:outline-none focus:border-[#c93448] transition-colors"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-[#9ca3af] text-xs mb-1",children:["Valor (editable)",e.jsx("span",{className:"text-[#6b7280] ml-1",children:"ðŸ’¡"})]}),e.jsx("input",{type:"number",min:"0",step:"1000",value:r.valorPaquete,onChange:c=>{const b=[...d.paquetes||[]];b[o]={...b[o],valorPaquete:parseFloat(c.target.value)||0},P("paquetes",b)},className:"w-full px-3 py-2 rounded-lg bg-[rgba(255,255,255,0.05)] border border-[rgba(255,255,255,0.1)] text-[#f9fafb] text-sm focus:outline-none focus:border-[#c93448] transition-colors",placeholder:"0"}),r.valorPaquete===0&&e.jsx("p",{className:"text-[#fbbf24] text-[10px] mt-0.5",children:"âš ï¸ Valor en $0 - Ãštil para 2do alumno en parejas"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[#9ca3af] text-xs mb-1",children:"Vigencia (dÃ­as)"}),e.jsx("input",{type:"number",min:"1",value:r.diasVigencia,onChange:c=>{const b=[...d.paquetes||[]];b[o]={...b[o],diasVigencia:parseInt(c.target.value)||30},P("paquetes",b)},className:"w-full px-3 py-2 rounded-lg bg-[rgba(255,255,255,0.05)] border border-[rgba(255,255,255,0.1)] text-[#f9fafb] text-sm focus:outline-none focus:border-[#c93448] transition-colors"})]}),p.descripcion&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-[#9ca3af] text-xs mb-1",children:"DescripciÃ³n"}),e.jsx("div",{className:"px-3 py-2 rounded-lg bg-[rgba(255,255,255,0.02)] border border-[rgba(255,255,255,0.05)] text-[#9ca3af] text-xs leading-relaxed",children:p.descripcion})]})]})]})]},o)}),(!d.paquetes||d.paquetes.length===0)&&e.jsx("div",{className:"text-center py-6 text-[#6b7280] text-sm",children:'No hay paquetes asociados. Click en "Agregar Paquete" para aÃ±adir uno.'})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 rounded-lg bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(255,255,255,0.08)] border border-[rgba(255,255,255,0.1)] text-[#d1d5db] transition-all",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:f.isPending,className:"flex-1 px-6 py-3 rounded-lg bg-[#c93448] hover:bg-[#b02d3c] text-white font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:f.isPending?"Registrando...":"Registrar Pago"})]})]})]})]})},W={all:["solicitudes"],renovacionPendientes:()=>[...W.all,"renovacion","pendientes"],clasePrivadaPendientes:()=>[...W.all,"clase-privada","pendientes"]};function pa(a=!0){return j({queryKey:W.renovacionPendientes(),queryFn:async()=>(await g.get("/api/solicitudes/renovacion-paquete/pendientes")).data,enabled:a,staleTime:120*1e3,refetchInterval:120*1e3,retry:2,refetchOnWindowFocus:!0})}function ma(a=!0){return j({queryKey:W.clasePrivadaPendientes(),queryFn:async()=>(await g.get("/api/solicitudes/clase-privada/pendientes")).data,enabled:a,staleTime:120*1e3,refetchInterval:120*1e3,retry:2,refetchOnWindowFocus:!0})}export{ta as C,O as G,de as P,ua as R,oe as S,He as a,Ue as b,Oe as c,Je as d,Xe as e,Ye as f,sa as g,ra as h,aa as i,ea as j,Ze as k,_e as l,le as m,da as n,na as o,oa as p,ca as q,la as r,ia as s,Ge as t,We as u,pa as v,ma as w};
